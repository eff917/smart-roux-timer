(this["webpackJsonpxiaomi-mi-smart-rubik-cube"]=this["webpackJsonpxiaomi-mi-smart-rubik-cube"]||[]).push([[0],{12:function(e,n,t){e.exports=t(21)},17:function(e,n,t){},19:function(e,n,t){},21:function(e,n,t){"use strict";t.r(n);var r=t(1),i=t.n(r),a=t(9),o=t.n(a),u=(t(17),t(7)),s=t.n(u),c=t(10),l=t(2),m=t(3),v=t(4),d=t(5),f=(navigator,function(e){return e.getPrimaryService("0000aadb-0000-1000-8000-00805f9b34fb").then((function(e){return window.mservice=e,e.getCharacteristic("0000aadc-0000-1000-8000-00805f9b34fb").then((function(e){return window.mcharacteristic=e,e.startNotifications(),e}))}))}),h=function(e){return e&&e.gatt.connected?e.gatt.disconnect():Promise.resolve()},b=function(e,n,t,r,i,a,o,u){var s=0;return 1===n?(e[t]=u,e[r]=a,e[i]=o):2===n?(e[t]=o,e[r]=u,e[i]=a):3===n?(e[t]=a,e[r]=o,e[i]=u):s=1,s},g=function(e,n,t,r,i,a,o,u){var s=0;return 2===n?(e[t]=u,e[r]=a,e[i]=o):1===n?(e[t]=o,e[r]=u,e[i]=a):3===n?(e[t]=a,e[r]=o,e[i]=u):s=1,s},p=function(e,n,t,r,i,a){var o=0;return o|=1===n?b(e,t,r,i,a,1,2,3):2===n?b(e,t,r,i,a,1,3,4):3===n?b(e,t,r,i,a,1,4,5):4===n?b(e,t,r,i,a,1,5,2):5===n?b(e,t,r,i,a,6,3,2):6===n?b(e,t,r,i,a,6,4,3):7===n?b(e,t,r,i,a,6,5,4):8===n?b(e,t,r,i,a,6,2,5):2},w=function(e,n,t,r,i,a){var o=0;return o|=1===n?g(e,t,r,i,a,1,2,3):2===n?g(e,t,r,i,a,1,3,4):3===n?g(e,t,r,i,a,1,4,5):4===n?g(e,t,r,i,a,1,5,2):5===n?g(e,t,r,i,a,6,3,2):6===n?g(e,t,r,i,a,6,4,3):7===n?g(e,t,r,i,a,6,5,4):8===n?g(e,t,r,i,a,6,2,5):2},y=function(e,n,t,r,i,a){var o=0;return 1===n?(e[t]=i,e[r]=a):2===n?(e[t]=a,e[r]=i):o=3,o},x=function(e,n,t,r,i){var a=0;return 1===n?a|=y(e,t,r,i,1,2):2===n?a|=y(e,t,r,i,1,3):3===n?a|=y(e,t,r,i,1,4):4===n?a|=y(e,t,r,i,1,5):5===n?a|=y(e,t,r,i,2,3):6===n?a|=y(e,t,r,i,4,3):7===n?a|=y(e,t,r,i,4,5):8===n?a|=y(e,t,r,i,2,5):9===n?a|=y(e,t,r,i,6,2):10===n?a|=y(e,t,r,i,6,3):11===n?a|=y(e,t,r,i,6,4):12===n?a|=y(e,t,r,i,6,5):a=4,a},S=function(e,n,t,r,i){var a=e[i];e[i]=e[r],e[r]=e[t],e[t]=e[n],e[n]=a},k=function(e){var n=function(e){var n=new Uint8Array(55),t=0,r=new Uint8Array(8),i=new Uint8Array(8),a=new Uint8Array(12),o=new Uint8Array(12);if(20!==e.length){for(var u=0;u<55;u++)n[u]=0;return n}r[0]=e[0]>>4,r[1]=15&e[0],r[2]=e[1]>>4,r[3]=15&e[1],r[4]=e[2]>>4,r[5]=15&e[2],r[6]=e[3]>>4,r[7]=15&e[3],i[0]=e[4]>>4,i[1]=15&e[4],i[2]=e[5]>>4,i[3]=15&e[5],i[4]=e[6]>>4,i[5]=15&e[6],i[6]=e[7]>>4,i[7]=15&e[7],a[0]=e[8]>>4,a[1]=15&e[8],a[2]=e[9]>>4,a[3]=15&e[9],a[4]=e[10]>>4,a[5]=15&e[10],a[6]=e[11]>>4,a[7]=15&e[11],a[8]=e[12]>>4,a[9]=15&e[12],a[10]=e[13]>>4,a[11]=15&e[13];for(var s=0;s<12;s+=1)o[s]=0;if(0!==(128&e[14])?o[0]=2:o[0]=1,0!==(64&e[14])?o[1]=2:o[1]=1,0!==(32&e[14])?o[2]=2:o[2]=1,0!==(16&e[14])?o[3]=2:o[3]=1,0!==(8&e[14])?o[4]=2:o[4]=1,0!==(4&e[14])?o[5]=2:o[5]=1,0!==(2&e[14])?o[6]=2:o[6]=1,0!==(1&e[14])?o[7]=2:o[7]=1,0!==(128&e[15])?o[8]=2:o[8]=1,0!==(64&e[15])?o[9]=2:o[9]=1,0!==(32&e[15])?o[10]=2:o[10]=1,0!==(16&e[15])?o[11]=2:o[11]=1,n[32]=1,n[41]=2,n[50]=3,n[14]=4,n[23]=5,n[5]=6,t|=p(n,r[0],i[0],34,43,54),t|=w(n,r[1],i[1],36,52,18),t|=p(n,r[2],i[2],30,16,27),t|=w(n,r[3],i[3],28,25,45),t|=w(n,r[4],i[4],1,48,37),t|=p(n,r[5],i[5],3,12,46),t|=w(n,r[6],i[6],9,21,10),t|=p(n,r[7],i[7],7,39,19),t|=x(n,a[0],o[0],31,44),t|=x(n,a[1],o[1],35,53),t|=x(n,a[2],o[2],33,17),t|=x(n,a[3],o[3],29,26),t|=x(n,a[4],o[4],40,51),t|=x(n,a[5],o[5],15,49),t|=x(n,a[6],o[6],13,24),t|=x(n,a[7],o[7],42,22),t|=x(n,a[8],o[8],4,38),t|=x(n,a[9],o[9],2,47),t|=x(n,a[10],o[10],6,11),t|=x(n,a[11],o[11],8,20),S(n,1,7,9,3),S(n,4,8,6,2),S(n,37,19,10,46),S(n,38,20,11,47),S(n,39,21,12,48),S(n,40,22,13,49),S(n,41,23,14,50),S(n,42,24,15,51),S(n,43,25,16,52),S(n,44,26,17,53),S(n,45,27,18,54),S(n,34,28,30,36),S(n,31,29,33,35),0!==t)for(var c=0;c<55;c++)n[c]=0;return n}(function(e){var n=new Uint8Array(20),t=[80,175,152,32,170,119,19,137,218,230,63,95,46,130,106,175,163,243,20,7,167,21,168,232,143,175,42,125,126,57,254,87,217,91,85,215];if(20!==e.byteLength)return e;if(167!==e.getUint8(18))return e;var r=e.getUint8(19);r&=15;var i=e.getUint8(19);i>>=4;for(var a=0;a<19;a+=1){n[a]=e.getUint8(a);var o=n,u=a;o[u]=o[u]-t[r+a];var s=n,c=a;s[c]=s[c]-t[i+a]}return n}(e));return Array.from(n).slice(1)},B=(t(19),t(0)),T=t(11),E=(t(20),new B.n);E.setSize(600,600),document.getElementById("viewer").appendChild(E.domElement);var O=new B.i;O.background=new B.b(15790320);var W=new B.g(75,1,.1,1e3);W.position.set(0,0,30);var Y=new T.a(W,E.domElement);Y.enabled=!0,Y.rotateSpeed=1,Y.zoomSpeed=1.2,Y.addEventListener("change",N),Y.minDistance=5,Y.maxDistance=30,Y.enablePan=!1;var F=0,C=39752,L=16766208,G=11997748,R=16777215,M=16734208,D=18093,A=[new B.f({color:F}),new B.f({color:C}),new B.f({color:L}),new B.f({color:G}),new B.f({color:R}),new B.f({color:M}),new B.f({color:D})],U=new B.a(3,3,3,3,3,3);function j(e){U.clearGroups();for(var n,t=0,r=48;r>-1;r-=6)U.addGroup(r,6,e[t]),t++;var i=[2,5,8,1,4,7,0,3,6];n=216,i.forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++})),n=108,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++}));for(var a=54;a<108;a+=6)U.addGroup(a,6,e[t]),t++;n=270,(i=[6,3,0,7,4,1,8,5,2]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++})),n=162,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++}))}var I=new B.e(U,A);function N(){E.render(O,W)}I.rotateZ(3.14),I.rotateY(2.355),I.rotateX(.785),O.add(I),W.position.z=5;var J;function H(e){var n=[];return J.forEach((function(t){var r=t.index.map((function(n){return e[n]}));JSON.stringify(r)==JSON.stringify(t.value)&&(t.name+" ",!0,n.push(t.name))})),n}J=[{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,5,5,3,3,4,4,4],name:"BWW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,4,4,4,5,5,3,3],name:"BWO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[5,5,1,1,1,1,1,1,3,3,4,4,4],name:"GWW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[3,3,4,4,4,1,1,1,1,1,1,5,5],name:"GWY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[3,3,1,1,1,1,1,1,4,4,4,5,5],name:"GWR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[4,4,4,5,5,1,1,1,1,1,1,3,3],name:"GWO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[6,6,1,1,3,3,3,3,3,3,4,4,4],name:"RWW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[1,1,4,4,4,6,6,3,3,3,3,3,3],name:"RWY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[4,4,4,6,6,3,3,3,3,3,3,1,1],name:"RWB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[1,1,4,4,4,3,3,3,3,3,3,6,6],name:"RWG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[6,6,5,5,5,5,5,5,1,1,4,4,4],name:"OWW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[1,1,5,5,5,5,5,5,4,4,4,6,6],name:"OWY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[4,4,4,5,5,5,5,5,5,6,6,1,1],name:"OWB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,1,1,4,4,4,6,6],name:"OWG"}].concat([{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,3,3,5,5,2,2,2],name:"BYW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,2,2,2,3,3,5,5],name:"BYO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[3,3,1,1,1,1,1,1,5,5,2,2,2],name:"GYW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[5,5,2,2,2,1,1,1,1,1,1,3,3],name:"GYY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[5,5,1,1,1,1,1,1,2,2,2,3,3],name:"GYR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[2,2,2,3,3,1,1,1,1,1,1,5,5],name:"GYO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[1,1,6,6,3,3,3,3,3,3,2,2,2],name:"RYW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[6,6,2,2,2,1,1,3,3,3,3,3,3],name:"RYY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[2,2,2,1,1,3,3,3,3,3,3,6,6],name:"RYB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[6,6,2,2,2,3,3,3,3,3,3,1,1],name:"RYG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[1,1,5,5,5,5,5,5,6,6,2,2,2],name:"OYW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[6,6,5,5,5,5,5,5,2,2,2,1,1],name:"OYY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[2,2,2,5,5,5,5,5,5,1,1,6,6],name:"OYB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,6,6,2,2,2,1,1],name:"OYG"}]);var q=function(){function e(n){Object(l.a)(this,e),this.currentTimeCallback=n,this.running=!1,this.animFrameBound=void 0,this.startTime=Date.now(),this.animFrameBound=this.animFrame.bind(this)}return Object(m.a)(e,[{key:"isRunning",value:function(){return this.running}},{key:"start",value:function(){this.startTime=Date.now(),this.running=!0,requestAnimationFrame(this.animFrameBound)}},{key:"getTime",value:function(){return this.elapsed()}},{key:"stop",value:function(){return this.running=!1,this.elapsed()}},{key:"reset",value:function(){}},{key:"animFrame",value:function(){this.running&&requestAnimationFrame(this.animFrameBound)}},{key:"elapsed",value:function(){return Date.now()-this.startTime}}]),e}(),z=function(){function e(n){Object(l.a)(this,e),this.solvedState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],this.timer=new q,this.solveTime=0}return Object(m.a)(e,[{key:"isSolved",value:function(e){return JSON.stringify(e)==JSON.stringify(this.solvedState)}},{key:"convertTime",value:function(e){var n=Math.floor(e/6e4<<0),t=Math.floor(e/1e3%60),r=(Math.floor(e%1e3)+"0").slice(0,2);return n>0?n+":"+("0"+t).slice(-2)+"."+r:t+"."+r}},{key:"stateTransition",value:function(e,n){if(n&&!this.timer.isRunning()&&(this.timer.start(),this.solveTime=0,console.log("Timer running")),this.timer.isRunning()&&this.isSolved(e))return this.solveTime=this.timer.stop(),document.getElementById("timer").innerHTML="<p>"+this.convertTime(this.solveTime)+"</p>",console.log("Timer stopped"),!1}}]),e}(),P=["g","y","r","w","o","b"],X=function(e){Object(d.a)(t,e);var n=Object(v.a)(t);function t(e){var r;return Object(l.a)(this,t),(r=n.call(this,e)).state={cubeState:"bbbbbbbbboooooooooyyyyyyyyygggggggggrrrrrrrrrwwwwwwwww"},r.cubeRawState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],r.device=null,r.ready=!1,r.timerController=new z,r.moveList=[],r.fbFound=!1,r.sbFound=!1,r.solveStats={},r}return Object(m.a)(t,[{key:"componentDidMount",value:function(){j(this.cubeRawState),N()}},{key:"componentWillUnmount",value:function(){h(this.device)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("div",null,i.a.createElement("button",{onClick:Object(c.a)(s.a.mark((function n(){var t,r,i;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["0000aadb-0000-1000-8000-00805f9b34fb"]}).then((function(e){return e.gatt.connect().then((function(n){return window.mdevice=e,window.mserver=n,{device:e,server:n}}))}));case 2:return t=n.sent,r=t.server,i=t.device,e.device=i,n.next=8,f(r);case 8:n.sent.addEventListener("characteristicvaluechanged",(function(n){var t=n.target.value,r=k(t);j(r),N();var i=k(t).map((function(e){return P[e-1]})).join("");e.setState({cubeState:i}),e.moveList.push(r+"<br />"),0==e.timerController.stateTransition(r,e.ready)&&(e.ready=!1);var a=H(r);a.length>0&&!e.fbFound&&(e.fbFound=!0,console.log("First block: "+a),console.log(e.timerController.timer.getTime()),e.solveStats.FB={movecount:e.moveList.length-1,block:a[0].slice(0,2),time:e.timerController.timer.getTime()}),a.length>1&&e.fbFound&&!e.sbFound&&(e.sbFound=!0,console.log("First and second block: "+a),console.log(e.timerController.timer.getTime()),a.forEach((function(n){n.slice(0,2)==e.solveStats.FB.block||(e.solveStats.SB={movecount:e.moveList.length-1,block:n.slice(0,2),time:e.timerController.timer.getTime()})}))),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />";var o="";for(var u in e.solveStats){switch(o+="<p>"+u+": "+e.solveStats[u].block,o+=" Moves: "+e.solveStats[u].movecount,o+=" Time: ",u){case"FB":o+=e.timerController.convertTime(e.solveStats[u].time);break;case"SB":o+=e.timerController.convertTime(e.solveStats[u].time-e.solveStats.FB.time);break;case"CMLL":o+=e.timerController.convertTime(e.solveStats[u].time-e.solveStats.SB.time);break;case"END":o+=e.timerController.convertTime(e.solveStats[u].time-e.solveStats.CMLL.time)}o+="</p><br />"}document.getElementById("moveDisplay").innerHTML=o})),i.addEventListener("gattserverdisconnected",(function(){h(i)}));case 11:case"end":return n.stop()}}),n)})))},"Connect cube"),i.a.createElement("button",{onClick:function(){e.moves=[],e.moveList=[],e.fbFound=!1,e.sbFound=!1,e.solveStats=[],e.moveList.push(e.cubeRawState),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />",document.getElementById("moveDisplay").innerHTML="<p></p><br />",e.ready=!0}},"Reset"),i.a.createElement("div",{id:"timer"},i.a.createElement("p",null,"0.00")),i.a.createElement("div",{id:"moveCount"}),i.a.createElement("div",{id:"moveDisplay"})))}}]),t}(i.a.Component);o.a.render(i.a.createElement(X,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.21c3299b.chunk.js.map
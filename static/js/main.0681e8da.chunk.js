(this["webpackJsonpxiaomi-mi-smart-rubik-cube"]=this["webpackJsonpxiaomi-mi-smart-rubik-cube"]||[]).push([[0],{12:function(e,n,t){e.exports=t(21)},17:function(e,n,t){},19:function(e,n,t){},21:function(e,n,t){"use strict";t.r(n);var a=t(1),i=t.n(a),r=t(9),o=t.n(r),u=(t(17),t(7)),c=t.n(u),s=t(10),v=t(2),l=t(3),m=t(4),d=t(5),f=(navigator,function(e){return e.getPrimaryService("0000aadb-0000-1000-8000-00805f9b34fb").then((function(e){return window.mservice=e,e.getCharacteristic("0000aadc-0000-1000-8000-00805f9b34fb").then((function(e){return window.mcharacteristic=e,e.startNotifications(),e}))}))}),h=function(e){return e&&e.gatt.connected?e.gatt.disconnect():Promise.resolve()},b=function(e,n,t,a,i,r,o,u){var c=0;return 1===n?(e[t]=u,e[a]=r,e[i]=o):2===n?(e[t]=o,e[a]=u,e[i]=r):3===n?(e[t]=r,e[a]=o,e[i]=u):c=1,c},g=function(e,n,t,a,i,r,o,u){var c=0;return 2===n?(e[t]=u,e[a]=r,e[i]=o):1===n?(e[t]=o,e[a]=u,e[i]=r):3===n?(e[t]=r,e[a]=o,e[i]=u):c=1,c},p=function(e,n,t,a,i,r){var o=0;return o|=1===n?b(e,t,a,i,r,1,2,3):2===n?b(e,t,a,i,r,1,3,4):3===n?b(e,t,a,i,r,1,4,5):4===n?b(e,t,a,i,r,1,5,2):5===n?b(e,t,a,i,r,6,3,2):6===n?b(e,t,a,i,r,6,4,3):7===n?b(e,t,a,i,r,6,5,4):8===n?b(e,t,a,i,r,6,2,5):2},w=function(e,n,t,a,i,r){var o=0;return o|=1===n?g(e,t,a,i,r,1,2,3):2===n?g(e,t,a,i,r,1,3,4):3===n?g(e,t,a,i,r,1,4,5):4===n?g(e,t,a,i,r,1,5,2):5===n?g(e,t,a,i,r,6,3,2):6===n?g(e,t,a,i,r,6,4,3):7===n?g(e,t,a,i,r,6,5,4):8===n?g(e,t,a,i,r,6,2,5):2},y=function(e,n,t,a,i,r){var o=0;return 1===n?(e[t]=i,e[a]=r):2===n?(e[t]=r,e[a]=i):o=3,o},x=function(e,n,t,a,i){var r=0;return 1===n?r|=y(e,t,a,i,1,2):2===n?r|=y(e,t,a,i,1,3):3===n?r|=y(e,t,a,i,1,4):4===n?r|=y(e,t,a,i,1,5):5===n?r|=y(e,t,a,i,2,3):6===n?r|=y(e,t,a,i,4,3):7===n?r|=y(e,t,a,i,4,5):8===n?r|=y(e,t,a,i,2,5):9===n?r|=y(e,t,a,i,6,2):10===n?r|=y(e,t,a,i,6,3):11===n?r|=y(e,t,a,i,6,4):12===n?r|=y(e,t,a,i,6,5):r=4,r},k=function(e,n,t,a,i){var r=e[i];e[i]=e[a],e[a]=e[t],e[t]=e[n],e[n]=r},E=function(e){var n=function(e){var n=new Uint8Array(55),t=0,a=new Uint8Array(8),i=new Uint8Array(8),r=new Uint8Array(12),o=new Uint8Array(12);if(20!==e.length){for(var u=0;u<55;u++)n[u]=0;return n}a[0]=e[0]>>4,a[1]=15&e[0],a[2]=e[1]>>4,a[3]=15&e[1],a[4]=e[2]>>4,a[5]=15&e[2],a[6]=e[3]>>4,a[7]=15&e[3],i[0]=e[4]>>4,i[1]=15&e[4],i[2]=e[5]>>4,i[3]=15&e[5],i[4]=e[6]>>4,i[5]=15&e[6],i[6]=e[7]>>4,i[7]=15&e[7],r[0]=e[8]>>4,r[1]=15&e[8],r[2]=e[9]>>4,r[3]=15&e[9],r[4]=e[10]>>4,r[5]=15&e[10],r[6]=e[11]>>4,r[7]=15&e[11],r[8]=e[12]>>4,r[9]=15&e[12],r[10]=e[13]>>4,r[11]=15&e[13];for(var c=0;c<12;c+=1)o[c]=0;if(0!==(128&e[14])?o[0]=2:o[0]=1,0!==(64&e[14])?o[1]=2:o[1]=1,0!==(32&e[14])?o[2]=2:o[2]=1,0!==(16&e[14])?o[3]=2:o[3]=1,0!==(8&e[14])?o[4]=2:o[4]=1,0!==(4&e[14])?o[5]=2:o[5]=1,0!==(2&e[14])?o[6]=2:o[6]=1,0!==(1&e[14])?o[7]=2:o[7]=1,0!==(128&e[15])?o[8]=2:o[8]=1,0!==(64&e[15])?o[9]=2:o[9]=1,0!==(32&e[15])?o[10]=2:o[10]=1,0!==(16&e[15])?o[11]=2:o[11]=1,n[32]=1,n[41]=2,n[50]=3,n[14]=4,n[23]=5,n[5]=6,t|=p(n,a[0],i[0],34,43,54),t|=w(n,a[1],i[1],36,52,18),t|=p(n,a[2],i[2],30,16,27),t|=w(n,a[3],i[3],28,25,45),t|=w(n,a[4],i[4],1,48,37),t|=p(n,a[5],i[5],3,12,46),t|=w(n,a[6],i[6],9,21,10),t|=p(n,a[7],i[7],7,39,19),t|=x(n,r[0],o[0],31,44),t|=x(n,r[1],o[1],35,53),t|=x(n,r[2],o[2],33,17),t|=x(n,r[3],o[3],29,26),t|=x(n,r[4],o[4],40,51),t|=x(n,r[5],o[5],15,49),t|=x(n,r[6],o[6],13,24),t|=x(n,r[7],o[7],42,22),t|=x(n,r[8],o[8],4,38),t|=x(n,r[9],o[9],2,47),t|=x(n,r[10],o[10],6,11),t|=x(n,r[11],o[11],8,20),k(n,1,7,9,3),k(n,4,8,6,2),k(n,37,19,10,46),k(n,38,20,11,47),k(n,39,21,12,48),k(n,40,22,13,49),k(n,41,23,14,50),k(n,42,24,15,51),k(n,43,25,16,52),k(n,44,26,17,53),k(n,45,27,18,54),k(n,34,28,30,36),k(n,31,29,33,35),0!==t)for(var s=0;s<55;s++)n[s]=0;return n}(function(e){var n=new Uint8Array(20),t=[80,175,152,32,170,119,19,137,218,230,63,95,46,130,106,175,163,243,20,7,167,21,168,232,143,175,42,125,126,57,254,87,217,91,85,215];if(20!==e.byteLength)return e;if(167!==e.getUint8(18))return e;var a=e.getUint8(19);a&=15;var i=e.getUint8(19);i>>=4;for(var r=0;r<19;r+=1){n[r]=e.getUint8(r);var o=n,u=r;o[u]=o[u]-t[a+r];var c=n,s=r;c[s]=c[s]-t[i+r]}return n}(e));return Array.from(n).slice(1)},O=(t(19),t(0)),S=t(11),W=(t(20),new O.n);W.setSize(600,600),document.getElementById("viewer").appendChild(W.domElement);var Y=new O.i;Y.background=new O.b(15790320);var B=new O.g(75,1,.1,1e3);B.position.set(0,0,30);var T=new S.a(B,W.domElement);T.enabled=!0,T.rotateSpeed=1,T.zoomSpeed=1.2,T.addEventListener("change",J),T.minDistance=5,T.maxDistance=30,T.enablePan=!1;var F=0,G=39752,R=16766208,L=11997748,C=16777215,M=16734208,A=18093,U=[new O.f({color:F}),new O.f({color:G}),new O.f({color:R}),new O.f({color:L}),new O.f({color:C}),new O.f({color:M}),new O.f({color:A})],j=new O.a(3,3,3,3,3,3);function D(e){j.clearGroups();for(var n,t=0,a=48;a>-1;a-=6)j.addGroup(a,6,e[t]),t++;var i=[2,5,8,1,4,7,0,3,6];n=216,i.forEach((function(a){j.addGroup(n+6*a,6,e[t]),t++})),n=108,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(a){j.addGroup(n+6*a,6,e[t]),t++}));for(var r=54;r<108;r+=6)j.addGroup(r,6,e[t]),t++;n=270,(i=[6,3,0,7,4,1,8,5,2]).forEach((function(a){j.addGroup(n+6*a,6,e[t]),t++})),n=162,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(a){j.addGroup(n+6*a,6,e[t]),t++}))}var I=new O.e(j,U);function J(){W.render(Y,B)}I.rotateZ(3.14),I.rotateY(2.355),I.rotateX(.785),Y.add(I),B.position.z=5;var N;function H(e){var n=[];return N.forEach((function(t){var a=t.index.map((function(n){return e[n]}));JSON.stringify(a)==JSON.stringify(t.value)&&(t.name+" ",!0,n.push(t.name))})),n}N=[{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,5,5,3,3,4,4,4],name:"BWW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,4,4,4,5,5,3,3],name:"BWO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[5,5,1,1,1,1,1,1,3,3,4,4,4],name:"GWW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[3,3,4,4,4,1,1,1,1,1,1,5,5],name:"GWY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[3,3,1,1,1,1,1,1,4,4,4,5,5],name:"GWR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[4,4,4,5,5,1,1,1,1,1,1,3,3],name:"GWO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[6,6,1,1,3,3,3,3,3,3,4,4,4],name:"RWW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[1,1,4,4,4,6,6,3,3,3,3,3,3],name:"RWY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[4,4,4,6,6,3,3,3,3,3,3,1,1],name:"RWB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[1,1,4,4,4,3,3,3,3,3,3,6,6],name:"RWG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[6,6,5,5,5,5,5,5,1,1,4,4,4],name:"OWW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[1,1,5,5,5,5,5,5,4,4,4,6,6],name:"OWY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[4,4,4,5,5,5,5,5,5,6,6,1,1],name:"OWB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,1,1,4,4,4,6,6],name:"OWG"}].concat([{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,3,3,5,5,2,2,2],name:"BYW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,2,2,2,3,3,5,5],name:"BYO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[3,3,1,1,1,1,1,1,5,5,2,2,2],name:"GYW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[5,5,2,2,2,1,1,1,1,1,1,3,3],name:"GYY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[5,5,1,1,1,1,1,1,2,2,2,3,3],name:"GYR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[2,2,2,3,3,1,1,1,1,1,1,5,5],name:"GYO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[1,1,6,6,3,3,3,3,3,3,2,2,2],name:"RYW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[6,6,2,2,2,1,1,3,3,3,3,3,3],name:"RYY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[2,2,2,1,1,3,3,3,3,3,3,6,6],name:"RYB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[6,6,2,2,2,3,3,3,3,3,3,1,1],name:"RYG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[1,1,5,5,5,5,5,5,6,6,2,2,2],name:"OYW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[6,6,5,5,5,5,5,5,2,2,2,1,1],name:"OYY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[2,2,2,5,5,5,5,5,5,1,1,6,6],name:"OYB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,6,6,2,2,2,1,1],name:"OYG"}]);var q=function(){function e(n){Object(v.a)(this,e),this.currentTimeCallback=n,this.running=!1,this.animFrameBound=void 0,this.startTime=0,this.animFrameBound=this.animFrame.bind(this)}return Object(l.a)(e,[{key:"isRunning",value:function(){return this.running}},{key:"start",value:function(){this.startTime=Date.now(),this.running=!0,requestAnimationFrame(this.animFrameBound)}},{key:"getTime",value:function(){return this.elapsed()}},{key:"stop",value:function(){return this.running=!1,this.elapsed()}},{key:"reset",value:function(){}},{key:"animFrame",value:function(){this.running&&requestAnimationFrame(this.animFrameBound)}},{key:"elapsed",value:function(){return Date.now()-this.startTime}}]),e}(),z=function(){function e(n){Object(v.a)(this,e),this.solvedState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],this.timer=new q,this.solveTime=0}return Object(l.a)(e,[{key:"isSolved",value:function(e){return JSON.stringify(e)==JSON.stringify(this.solvedState)}},{key:"convertTime",value:function(e){var n=Math.floor(e/6e4<<0),t=Math.floor(e/1e3%60),a=(Math.floor(e%1e3)+"0").slice(0,2);return n>0?n+":"+("0"+t).slice(-2)+"."+a:t+"."+a}},{key:"stateTransition",value:function(e,n){if(n&&!this.timer.isRunning()&&(this.timer.start(),this.solveTime=0,console.log("Timer running")),this.timer.isRunning()&&this.isSolved(e))return this.solveTime=this.timer.stop(),document.getElementById("timer").innerHTML="<p>"+this.convertTime(this.solveTime)+"</p>",console.log("Timer stopped"),!1}}]),e}(),P=["g","y","r","w","o","b"],X=function(e){Object(d.a)(t,e);var n=Object(m.a)(t);function t(e){var a;return Object(v.a)(this,t),(a=n.call(this,e)).state={cubeState:"bbbbbbbbboooooooooyyyyyyyyygggggggggrrrrrrrrrwwwwwwwww"},a.cubeRawState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],a.device=null,a.moves=[],a.ready=!1,a.timerController=new z,a.moveList=[],a.fbFound=!1,a.sbFound=!1,a.solveStats=[],a}return Object(l.a)(t,[{key:"componentDidMount",value:function(){D(this.cubeRawState),J()}},{key:"componentWillUnmount",value:function(){h(this.device)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("div",null,i.a.createElement("button",{onClick:Object(s.a)(c.a.mark((function n(){var t,a,i;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["0000aadb-0000-1000-8000-00805f9b34fb"]}).then((function(e){return e.gatt.connect().then((function(n){return window.mdevice=e,window.mserver=n,{device:e,server:n}}))}));case 2:return t=n.sent,a=t.server,i=t.device,e.device=i,n.next=8,f(a);case 8:n.sent.addEventListener("characteristicvaluechanged",(function(n){var t=n.target.value,a=E(t);e.moves.push(a),D(a),J();var i=E(t).map((function(e){return P[e-1]})).join("");e.setState({cubeState:i}),e.moveList.push(a+"<br />"),0==e.timerController.stateTransition(a,e.ready)&&(e.ready=!1);var r=H(a);r.length>0&&!e.fbFound&&(e.fbFound=!0,console.log("First block: "+r),e.solveStats.push({movecount:e.moveList.length-1,block:r[0].slice(0,2)})),r.length>1&&e.fbFound&&!e.sbFound&&(e.sbFound=!0,console.log("First and second block: "+r),r.forEach((function(n){n.slice(0,2)==e.solveStats[0].block||e.solveStats.push({movecount:e.moveList.length-1,block:n.slice(0,2)})}))),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />";var o="";e.solveStats.forEach((function(e){o+="<p>Block: "+e.block+" Moves: "+e.movecount+"</p><br />"})),document.getElementById("moveDisplay").innerHTML=o})),i.addEventListener("gattserverdisconnected",(function(){h(i)}));case 11:case"end":return n.stop()}}),n)})))},"Connect cube"),i.a.createElement("button",{onClick:function(){e.moves=[],e.moveList=[],e.fbFound=!1,e.sbFound=!1,e.solveStats=[],e.moveList.push(e.cubeRawState),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />",document.getElementById("moveDisplay").innerHTML="<p>"+e.moveList+"</p><br />",e.ready=!0}},"Reset"),i.a.createElement("div",{id:"timer"},i.a.createElement("p",null,"0.00")),i.a.createElement("div",{id:"moveCount"}),i.a.createElement("div",{id:"moveDisplay"})))}}]),t}(i.a.Component);o.a.render(i.a.createElement(X,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.0681e8da.chunk.js.map
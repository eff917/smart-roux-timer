(this["webpackJsonpxiaomi-mi-smart-rubik-cube"]=this["webpackJsonpxiaomi-mi-smart-rubik-cube"]||[]).push([[0],{12:function(e,n,t){e.exports=t(21)},17:function(e,n,t){},19:function(e,n,t){},21:function(e,n,t){"use strict";t.r(n);var r=t(1),i=t.n(r),o=t(9),a=t.n(o),l=(t(17),t(7)),u=t.n(l),s=t(10),m=t(2),c=t(3),v=t(4),d=t(5),f=(navigator,function(e){return e.getPrimaryService("0000aadb-0000-1000-8000-00805f9b34fb").then((function(e){return window.mservice=e,e.getCharacteristic("0000aadc-0000-1000-8000-00805f9b34fb").then((function(e){return window.mcharacteristic=e,e.startNotifications(),e}))}))}),h=function(e){return e&&e.gatt.connected?e.gatt.disconnect():Promise.resolve()},g=function(e,n,t,r,i,o,a,l){var u=0;return 1===n?(e[t]=l,e[r]=o,e[i]=a):2===n?(e[t]=a,e[r]=l,e[i]=o):3===n?(e[t]=o,e[r]=a,e[i]=l):u=1,u},b=function(e,n,t,r,i,o,a,l){var u=0;return 2===n?(e[t]=l,e[r]=o,e[i]=a):1===n?(e[t]=a,e[r]=l,e[i]=o):3===n?(e[t]=o,e[r]=a,e[i]=l):u=1,u},p=function(e,n,t,r,i,o){var a=0;return a|=1===n?g(e,t,r,i,o,1,2,3):2===n?g(e,t,r,i,o,1,3,4):3===n?g(e,t,r,i,o,1,4,5):4===n?g(e,t,r,i,o,1,5,2):5===n?g(e,t,r,i,o,6,3,2):6===n?g(e,t,r,i,o,6,4,3):7===n?g(e,t,r,i,o,6,5,4):8===n?g(e,t,r,i,o,6,2,5):2},y=function(e,n,t,r,i,o){var a=0;return a|=1===n?b(e,t,r,i,o,1,2,3):2===n?b(e,t,r,i,o,1,3,4):3===n?b(e,t,r,i,o,1,4,5):4===n?b(e,t,r,i,o,1,5,2):5===n?b(e,t,r,i,o,6,3,2):6===n?b(e,t,r,i,o,6,4,3):7===n?b(e,t,r,i,o,6,5,4):8===n?b(e,t,r,i,o,6,2,5):2},w=function(e,n,t,r,i,o){var a=0;return 1===n?(e[t]=i,e[r]=o):2===n?(e[t]=o,e[r]=i):a=3,a},S=function(e,n,t,r,i){var o=0;return 1===n?o|=w(e,t,r,i,1,2):2===n?o|=w(e,t,r,i,1,3):3===n?o|=w(e,t,r,i,1,4):4===n?o|=w(e,t,r,i,1,5):5===n?o|=w(e,t,r,i,2,3):6===n?o|=w(e,t,r,i,4,3):7===n?o|=w(e,t,r,i,4,5):8===n?o|=w(e,t,r,i,2,5):9===n?o|=w(e,t,r,i,6,2):10===n?o|=w(e,t,r,i,6,3):11===n?o|=w(e,t,r,i,6,4):12===n?o|=w(e,t,r,i,6,5):o=4,o},x=function(e,n,t,r,i){var o=e[i];e[i]=e[r],e[r]=e[t],e[t]=e[n],e[n]=o},T=function(e){var n=function(e){var n=new Uint8Array(55),t=0,r=new Uint8Array(8),i=new Uint8Array(8),o=new Uint8Array(12),a=new Uint8Array(12);if(20!==e.length){for(var l=0;l<55;l++)n[l]=0;return n}r[0]=e[0]>>4,r[1]=15&e[0],r[2]=e[1]>>4,r[3]=15&e[1],r[4]=e[2]>>4,r[5]=15&e[2],r[6]=e[3]>>4,r[7]=15&e[3],i[0]=e[4]>>4,i[1]=15&e[4],i[2]=e[5]>>4,i[3]=15&e[5],i[4]=e[6]>>4,i[5]=15&e[6],i[6]=e[7]>>4,i[7]=15&e[7],o[0]=e[8]>>4,o[1]=15&e[8],o[2]=e[9]>>4,o[3]=15&e[9],o[4]=e[10]>>4,o[5]=15&e[10],o[6]=e[11]>>4,o[7]=15&e[11],o[8]=e[12]>>4,o[9]=15&e[12],o[10]=e[13]>>4,o[11]=15&e[13];for(var u=0;u<12;u+=1)a[u]=0;if(0!==(128&e[14])?a[0]=2:a[0]=1,0!==(64&e[14])?a[1]=2:a[1]=1,0!==(32&e[14])?a[2]=2:a[2]=1,0!==(16&e[14])?a[3]=2:a[3]=1,0!==(8&e[14])?a[4]=2:a[4]=1,0!==(4&e[14])?a[5]=2:a[5]=1,0!==(2&e[14])?a[6]=2:a[6]=1,0!==(1&e[14])?a[7]=2:a[7]=1,0!==(128&e[15])?a[8]=2:a[8]=1,0!==(64&e[15])?a[9]=2:a[9]=1,0!==(32&e[15])?a[10]=2:a[10]=1,0!==(16&e[15])?a[11]=2:a[11]=1,n[32]=1,n[41]=2,n[50]=3,n[14]=4,n[23]=5,n[5]=6,t|=p(n,r[0],i[0],34,43,54),t|=y(n,r[1],i[1],36,52,18),t|=p(n,r[2],i[2],30,16,27),t|=y(n,r[3],i[3],28,25,45),t|=y(n,r[4],i[4],1,48,37),t|=p(n,r[5],i[5],3,12,46),t|=y(n,r[6],i[6],9,21,10),t|=p(n,r[7],i[7],7,39,19),t|=S(n,o[0],a[0],31,44),t|=S(n,o[1],a[1],35,53),t|=S(n,o[2],a[2],33,17),t|=S(n,o[3],a[3],29,26),t|=S(n,o[4],a[4],40,51),t|=S(n,o[5],a[5],15,49),t|=S(n,o[6],a[6],13,24),t|=S(n,o[7],a[7],42,22),t|=S(n,o[8],a[8],4,38),t|=S(n,o[9],a[9],2,47),t|=S(n,o[10],a[10],6,11),t|=S(n,o[11],a[11],8,20),x(n,1,7,9,3),x(n,4,8,6,2),x(n,37,19,10,46),x(n,38,20,11,47),x(n,39,21,12,48),x(n,40,22,13,49),x(n,41,23,14,50),x(n,42,24,15,51),x(n,43,25,16,52),x(n,44,26,17,53),x(n,45,27,18,54),x(n,34,28,30,36),x(n,31,29,33,35),0!==t)for(var s=0;s<55;s++)n[s]=0;return n}(function(e){var n=new Uint8Array(20),t=[80,175,152,32,170,119,19,137,218,230,63,95,46,130,106,175,163,243,20,7,167,21,168,232,143,175,42,125,126,57,254,87,217,91,85,215];if(20!==e.byteLength)return e;if(167!==e.getUint8(18))return e;var r=e.getUint8(19);r&=15;var i=e.getUint8(19);i>>=4;for(var o=0;o<19;o+=1){n[o]=e.getUint8(o);var a=n,l=o;a[l]=a[l]-t[r+o];var u=n,s=o;u[s]=u[s]-t[i+o]}return n}(e));return Array.from(n).slice(1)},E=(t(19),t(0)),C=t(11),k=(t(20),new E.n);k.setSize(600,600),document.getElementById("viewer").appendChild(k.domElement);var B=new E.i;B.background=new E.b(15790320);var O=new E.g(75,1,.1,1e3);O.position.set(0,0,30);var L=new C.a(O,k.domElement);L.enabled=!0,L.rotateSpeed=1,L.zoomSpeed=1.2,L.addEventListener("change",I),L.minDistance=5,L.maxDistance=30,L.enablePan=!1;var W=0,Y=39752,F=16766208,D=11997748,G=16777215,R=16734208,M=18093,A=[new E.f({color:W}),new E.f({color:Y}),new E.f({color:F}),new E.f({color:D}),new E.f({color:G}),new E.f({color:R}),new E.f({color:M})],U=new E.a(3,3,3,3,3,3);function j(e){U.clearGroups();for(var n,t=0,r=48;r>-1;r-=6)U.addGroup(r,6,e[t]),t++;var i=[2,5,8,1,4,7,0,3,6];n=216,i.forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++})),n=108,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++}));for(var o=54;o<108;o+=6)U.addGroup(o,6,e[t]),t++;n=270,(i=[6,3,0,7,4,1,8,5,2]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++})),n=162,(i=[2,5,8,1,4,7,0,3,6]).forEach((function(r){U.addGroup(n+6*r,6,e[t]),t++}))}var N=new E.e(U,A);function I(){k.render(B,O)}N.rotateZ(3.14),N.rotateY(2.355),N.rotateX(.785),B.add(N),O.position.z=5;var J,H=function(){function e(n){Object(m.a)(this,e),this.currentTimeCallback=n,this.running=!1,this.animFrameBound=void 0,this.startTime=Date.now(),this.animFrameBound=this.animFrame.bind(this)}return Object(c.a)(e,[{key:"isRunning",value:function(){return this.running}},{key:"start",value:function(){this.startTime=Date.now(),this.running=!0,requestAnimationFrame(this.animFrameBound)}},{key:"getTime",value:function(){return this.elapsed()}},{key:"stop",value:function(){return this.running=!1,this.elapsed()}},{key:"reset",value:function(){}},{key:"animFrame",value:function(){this.running&&requestAnimationFrame(this.animFrameBound)}},{key:"elapsed",value:function(){return Date.now()-this.startTime}}]),e}(),q=function(){function e(n){Object(m.a)(this,e),this.solvedState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],this.timer=new H,this.solveTime=0}return Object(c.a)(e,[{key:"isSolved",value:function(e){return JSON.stringify(e)==JSON.stringify(this.solvedState)}},{key:"convertTime",value:function(e){var n=Math.floor(e/6e4<<0),t=Math.floor(e/1e3%60),r=("00"+Math.floor(e%1e3)).substr(-3,2);return n>0?n+":"+("0"+t).slice(-2)+"."+r:t+"."+r}},{key:"stateTransition",value:function(e,n){if(n&&!this.timer.isRunning()&&(this.timer.start(),this.solveTime=0,console.log("Timer running")),this.timer.isRunning()&&this.isSolved(e))return this.solveTime=this.timer.stop(),document.getElementById("timer").innerHTML="<p>"+this.convertTime(this.solveTime)+"</p>",console.log("Timer stopped"),!1}}]),e}();function z(e){var n=[];return J.forEach((function(t){var r=t.index.map((function(n){return e[n]}));JSON.stringify(r)==JSON.stringify(t.value)&&(t.name+" ",!0,n.push(t.name))})),n}J=[{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,5,5,3,3,4,4,4],name:"BWW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,3,3,4,4,4,5,5],name:"BWR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,4,4,4,5,5,3,3],name:"BWO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[5,5,1,1,1,1,1,1,3,3,4,4,4],name:"GWW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[3,3,4,4,4,1,1,1,1,1,1,5,5],name:"GWY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[3,3,1,1,1,1,1,1,4,4,4,5,5],name:"GWR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[4,4,4,5,5,1,1,1,1,1,1,3,3],name:"GWO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[6,6,1,1,3,3,3,3,3,3,4,4,4],name:"RWW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[1,1,4,4,4,6,6,3,3,3,3,3,3],name:"RWY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[4,4,4,6,6,3,3,3,3,3,3,1,1],name:"RWB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[1,1,4,4,4,3,3,3,3,3,3,6,6],name:"RWG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[6,6,5,5,5,5,5,5,1,1,4,4,4],name:"OWW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[1,1,5,5,5,5,5,5,4,4,4,6,6],name:"OWY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[4,4,4,5,5,5,5,5,5,6,6,1,1],name:"OWB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,1,1,4,4,4,6,6],name:"OWG"}].concat([{index:[0,1,2,3,4,5,10,11,36,37,45,46,47],value:[6,6,6,6,6,6,3,3,5,5,2,2,2],name:"BYW"},{index:[3,4,5,6,7,8,9,10,18,19,20,37,38],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYY"},{index:[0,1,3,4,6,7,18,19,36,37,38,46,47],value:[6,6,6,6,6,6,5,5,2,2,2,3,3],name:"BYR"},{index:[1,2,4,5,7,8,9,10,11,19,20,45,46],value:[6,6,6,6,6,6,2,2,2,3,3,5,5],name:"BYO"},{index:[16,17,30,31,32,33,34,35,42,43,51,52,53],value:[3,3,1,1,1,1,1,1,5,5,2,2,2],name:"GYW"},{index:[15,16,24,25,26,27,28,29,30,31,32,43,44],value:[5,5,2,2,2,1,1,1,1,1,1,3,3],name:"GYY"},{index:[24,25,27,28,30,31,33,34,42,43,44,52,53],value:[5,5,1,1,1,1,1,1,2,2,2,3,3],name:"GYR"},{index:[15,16,17,25,26,28,29,31,32,34,35,51,52],value:[2,2,2,3,3,1,1,1,1,1,1,5,5],name:"GYO"},{index:[0,3,30,33,36,37,39,40,42,43,47,50,53],value:[1,1,6,6,3,3,3,3,3,3,2,2,2],name:"RYW"},{index:[3,6,18,21,24,27,30,37,38,40,41,43,44],value:[6,6,2,2,2,1,1,3,3,3,3,3,3],name:"RYY"},{index:[0,3,6,18,21,36,37,38,39,40,41,47,50],value:[2,2,2,1,1,3,3,3,3,3,3,6,6],name:"RYB"},{index:[21,24,27,30,33,39,40,41,42,43,44,50,53],value:[6,6,2,2,2,3,3,3,3,3,3,1,1],name:"RYG"},{index:[2,5,10,11,13,14,16,17,32,35,45,48,51],value:[1,1,5,5,5,5,5,5,6,6,2,2,2],name:"OYW"},{index:[5,8,9,10,12,13,15,16,20,23,26,29,32],value:[6,6,5,5,5,5,5,5,2,2,2,1,1],name:"OYY"},{index:[2,5,8,9,10,11,12,13,14,20,23,45,48],value:[2,2,2,5,5,5,5,5,5,1,1,6,6],name:"OYB"},{index:[12,13,14,15,16,17,23,26,29,32,35,48,51],value:[5,5,5,5,5,5,6,6,2,2,2,1,1],name:"OYG"}]);var P=[[0,2,6,8],[9,11,15,17],[18,20,24,26],[27,29,33,35],[36,38,42,44],[45,47,51,53]],X=["[1,1,1,1]","[2,2,2,2]","[3,3,3,3]","[4,4,4,4]","[5,5,5,5]","[6,6,6,6]"];function Z(e){var n=!0;return P.forEach((function(t){var r=JSON.stringify(t.map((function(n){return e[n]})));X.includes(r)||(n=!1)})),n}var K=[18,19,20,21,22,23,24,25,26,45,46,47,48,49,50,51,52,53],Q=function(e){return[2,4].includes(e)};var V=function(e){Object(d.a)(t,e);var n=Object(v.a)(t);function t(e){var r;return Object(m.a)(this,t),(r=n.call(this,e)).cubeRawState=[6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4],r.device=null,r.ready=!1,r.timerController=new q,r.moveList=[],r.fbFound=!1,r.sbFound=!1,r.cmllDone=!1,r.eoDone=!1,r.solved=!1,r.solveStats={},r}return Object(c.a)(t,[{key:"componentDidMount",value:function(){j(this.cubeRawState),I()}},{key:"componentWillUnmount",value:function(){h(this.device)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"App"},i.a.createElement("div",null,i.a.createElement("button",{onClick:Object(s.a)(u.a.mark((function n(){var t,r,i;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["0000aadb-0000-1000-8000-00805f9b34fb"]}).then((function(e){return e.gatt.connect().then((function(n){return window.mdevice=e,window.mserver=n,{device:e,server:n}}))}));case 2:return t=n.sent,r=t.server,i=t.device,e.device=i,n.next=8,f(r);case 8:n.sent.addEventListener("characteristicvaluechanged",(function(n){var t=n.target.value,r=T(t);j(r),I(),e.moveList.push(r),0==e.timerController.stateTransition(r,e.ready)&&(e.ready=!1);var i,o=z(r);o.length>0&&!e.fbFound&&(e.fbFound=!0,console.log("First block: "+o+" "+e.timerController.timer.getTime()),e.solveStats.FB={movecount:e.moveList.length-1,block:o[0].slice(0,2),time:e.timerController.timer.getTime()}),o.length>1&&e.fbFound&&!e.sbFound&&(e.sbFound=!0,console.log("First and second block: "+o+" "+e.timerController.timer.getTime()),o.forEach((function(n){n.slice(0,2)==e.solveStats.FB.block||(e.solveStats.SB={movecount:e.moveList.length-1,block:n.slice(0,2),time:e.timerController.timer.getTime()})}))),!e.cmllDone&&e.sbFound&&Z(r)&&(console.log("CMLL done "+e.timerController.timer.getTime()),e.solveStats.CMLL={movecount:e.moveList.length-1,time:e.timerController.timer.getTime()},e.cmllDone=!0),!e.eoDone&&e.cmllDone&&(i=r,K.map((function(e){return i[e]})).every(Q))&&(console.log("LSE/EO done "+e.timerController.timer.getTime()),e.solveStats.EO={movecount:e.moveList.length-1,time:e.timerController.timer.getTime()},e.eoDone=!0),!e.solved&&e.eoDone&&e.timerController.isSolved(r)&&(console.log("Cube solved! "+e.timerController.timer.getTime()),e.solveStats.END={movecount:e.moveList.length-1,time:e.timerController.timer.getTime()},e.solved=!0),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />";var a="";for(var l in e.solveStats){switch(a+="<p>"+l+": "+e.solveStats[l].block,a+=" Moves: "+e.solveStats[l].movecount,a+=" Time: ",l){case"FB":a+=e.timerController.convertTime(e.solveStats[l].time);break;case"SB":a+=e.timerController.convertTime(e.solveStats[l].time-e.solveStats.FB.time);break;case"CMLL":a+=e.timerController.convertTime(e.solveStats[l].time-e.solveStats.SB.time);break;case"EO":a+=e.timerController.convertTime(e.solveStats[l].time-e.solveStats.CMLL.time);break;case"END":a+=e.timerController.convertTime(e.solveStats[l].time-e.solveStats.EO.time)}a+="</p>"}document.getElementById("moveDisplay").innerHTML=a})),i.addEventListener("gattserverdisconnected",(function(){h(i)}));case 11:case"end":return n.stop()}}),n)})))},"Connect cube"),i.a.createElement("button",{onClick:function(){e.moves=[],e.moveList=[],e.fbFound=!1,e.sbFound=!1,e.cmllDone=!1,e.eoDone=!1,e.solved=!1,e.solveStats=[],e.moveList.push(e.cubeRawState),document.getElementById("moveCount").innerHTML="<p>Moves: "+(e.moveList.length-1)+"</p><br />",document.getElementById("moveDisplay").innerHTML="<p></p><br />",e.ready=!0}},"Ready"),i.a.createElement("div",{id:"timer"},i.a.createElement("p",null,"0.00")),i.a.createElement("div",{id:"moveCount"}),i.a.createElement("div",{id:"moveDisplay"})))}}]),t}(i.a.Component);a.a.render(i.a.createElement(V,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.b79f4bbf.chunk.js.map